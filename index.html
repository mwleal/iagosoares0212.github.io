
<html>
<head>
  <meta charset="UTF-8">
  <script src="https://github.com/processing/p5.js/releases/download/0.5.16/p5.js"></script> 
  <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/0.9.0/addons/p5.sound.min.js"></script>
  <script>
var idle = [];
function preload() {
  for(i=0;i<7;i++) {
    idle[i] = loadImage('https://raw.githubusercontent.com/iagosoares0212/iagosoares0212.github.io/master/ATTACK_00'+i+'.png');
  }
}
                        
function setup() {
  createCanvas(1200, 550);
}
  
  var x = 51;
  var y = 451;
  var lado = 1;
  var vida = 3;
  var pulo = 0;
  var contd = 0;
  var conta = 0;
  var start = 0;
  var x1 = 0;
  var y1 = 0;

var telaAtiva = 1
function draw() {
   switch(telaAtiva) {
    case 1:
      inicio();
      break;
    case 2:
      intro();
      break;
   }
}
function keyPressed() {
    if(keyCode === ENTER && telaAtiva===1){
      telaAtiva = 2
  }
}




function inicio() {
  let tela = 1
  background('green');
  fill(200,0,0)
  textSize(20);
  text('aperte enter para começar',475 , 450);
  textSize(40)
  textStyle(BOLD)
  text('Torre da matemática',410,100)  
  
}




function torre() {
  let map = [
    [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],
    [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
    [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
    [1,0,0,0,0,3,0,0,0,0,0,3,0,0,0,0,0,0,3,0,0,0,0,1],
    [1,0,0,0,0,3,0,0,0,0,0,3,0,0,0,0,0,0,3,0,0,0,0,1],
    [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,1],
    [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,1],
    [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,1],
    [1,0,0,0,0,3,0,0,0,0,0,3,0,0,0,0,0,0,3,0,0,0,2,1],
    [1,0,0,0,0,3,0,0,0,0,0,3,0,0,0,0,0,0,3,0,0,0,2,1],
    [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]
  ];
  var tileSize=50;
  background(220);
  for (let i = 0; i < map.length; i++) {
    for (let j = 0; j < map[i].length; j++) {
      if (map[i][j] === 1) {
        fill(150, 0, 0);
        rect(j * tileSize, i * tileSize, tileSize, tileSize);
      }
      if (map[i][j] === 2) {
        fill(0, 150, 0);
        rect(j * tileSize, i * tileSize, tileSize, tileSize);
      }
      if (map[i][j] === 3) {
        fill(0, 150, 150);
        rect(j * tileSize, i * tileSize, tileSize, tileSize);
      }
    }
  }
  if (keyIsDown(LEFT_ARROW) && !bateuNoMapa(x-5,y)) {
    x-=8;    
  }
  if (keyIsDown(RIGHT_ARROW)&& !bateuNoMapa(x+5,y)  ){
    x+=8;
  }
  if (!bateuNoMapa(x,y+5)&& !escada(x,y+5)) {
    y+=8;
  }
  if (keyIsDown(DOWN_ARROW) && !bateuNoMapa(x,y+5)&& escada(x,y+5)) {
    y+=8;
  }
  if (keyIsDown(UP_ARROW) && !bateuNoMapa(x,y-5)&& escada(x,y+5)) {
    y-=8;
  }
  fill(0, 0, 250);
  rect(x, y, 48, 48);
  function bateuNoMapa(a, b) {
    let bateu=false; 
    for (var i = 0; i < map.length; i++) {
      for (var j = 0; j < map[i].length; j++) {
        if(map[i][j]==1 && colisao(a,b,j * tileSize,i * tileSize)){
          bateu=true;
          return bateu;
        }
      }
    }
    return bateu;
  }
  function escada(a, b) {
    let stair=false; 
    for (var i = 0; i < map.length; i++) {
      for (var j = 0; j < map[i].length; j++) {
        if(map[i][j]==2 && colisao(a,b,j * tileSize,i * tileSize)){
          stair=true;
          return stair;
        }
      }
    }
    return stair;
  }
  function porta(a, b) {
    let door=false; 
    for (var i = 0; i < map.length; i++) {
      for (var j = 0; j < map[i].length; j++) {
        if(map[i][j]==3 && colisao(a,b,j * tileSize,i * tileSize)){
          door=true;
          return door;
        }
      }
    }
    return stair;
  }
  function colisao(x1,y1,x2,y2) {
    if(x1 > x2 + 48)
      return false;
    if(y1 > y2 + 48)
      return false;
    if(x1 + 48 < x2)
      return false;
    if(y1 + 48 < y2)
      return false;
    return true;
  }
}






function intro() {
  let map = [
    [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],
    [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
    [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
    [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
    [1,3,0,0,0,0,0,0,0,0,5,0,0,0,0,0,7,0,0,0,0,0,0,1],
    [1,4,0,0,0,0,0,0,0,0,6,0,0,0,0,0,8,0,0,0,0,0,0,1],
    [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
    [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
    [1,0,0,0,0,0,0,0,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,1],
    [1,0,0,0,0,0,0,0,1,1,2,2,1,1,0,0,0,0,0,0,9,0,0,1],
    [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]
  ];
  var tileSize=50;
  background(220);
  for (let i = 0; i < map.length; i++) {
    for (let j = 0; j < map[i].length; j++) {
      if (map[i][j] === 1) {
        fill(150, 0, 0);
        rect(j * tileSize, i * tileSize, tileSize, tileSize);
      }
      if (map[i][j] === 2) {
        fill(300, 150, 0);
        rect(j * tileSize, i * tileSize, tileSize, tileSize);
      }
      if (map[i][j] === 3) {
        textSize(20); 
        text('Use as setas direcionais',j * tileSize, i * tileSize);
      }
      if (map[i][j] === 4) {
        textSize(20); 
        text('      para movimentar',j * tileSize, i * tileSize);
      }
      if (map[i][j] === 5) {
        textSize(20); 
        text('Aperte para cima',j * tileSize, i * tileSize);
      }
      if (map[i][j] === 6) {
        textSize(20); 
        text('      para pular',j * tileSize, i * tileSize);
      }
      if (map[i][j] === 7) {
        textSize(20); 
        text('Aperte a barra de espaço para',j * tileSize, i * tileSize);
      }
      if (map[i][j] === 8) {
        textSize(20); 
        text('atacar e interagir com objetos',j * tileSize, i * tileSize);
      }
          if (map[i][j] === 9) {
        fill(0, 150, 150);
        rect(j * tileSize, i * tileSize, tileSize, tileSize);
      }
      
    }
  }
  
  
   textSize(20);
   text('vidas:'+vida,100 , 100);
  
  if (keyIsDown(LEFT_ARROW) && !bateuNoMapa(x-5,y)) {
    x-=5;
    lado = 0;
  }
  if (keyIsDown(RIGHT_ARROW)&& !bateuNoMapa(x+5,y)  ){
    x+=5;
    lado = 1;
  }
  if (!bateuNoMapa(x,y+5)) 
    y+=5; 
   else
    pulo = 0
  
  if (keyIsDown(UP_ARROW) && !bateuNoMapa(x,y-20)&& pulo<20) {
    y-=10;
    pulo++
  }
  if(keyIsDown(32) && conta == 0) {
    if(lado == 1) {
      fill(0, 0, 250);
      rect(x+50, y, 48, 48);
      if(colisao(x+50,y,x1,y1))
         x1 = 2000
    }
    if(lado == 0) {
      fill(0, 0, 250);
      rect(x-50, y, 48, 48);
        if(colisao(x-50,y,x1,y1))
         x1 = 2000
    }
  conta = 50;
  }
  
  
  if(contd>0) {
    contd--;
  }
  if(conta>0) {
    conta--;
  }
  if(dano(x,y) && contd == 0) {
    vida--;
    contd = 50;
  }
  
  if(vida == 0) {
    start = 0;
  }
  
  if(start == 0) {
    x = 51;
    y = 451;
    lado = 1;
    vida = 3;
    x1 = 875;
    y1 = 451;
    start = 1;
  }
  
  if(colisao(x,y,x1,y1) && contd == 0) {
     vida--;
    contd = 50;
     }
  
  for(i=0;!keyIsDown();i++) {
    image(idle[i],x,y);
      if(i==6)
        i=0
  }
  
  fill(0, 0, 0);
  rect(x1, y1, 48, 48);
  
  if(x<x1+200 && x>x1 && !bateuNoMapa(x1+5,y1))
    x1+=3
  if(x>x1-200 && x<x1 && !bateuNoMapa(x1-5,y1))
    x1-=3
  
  
  function bateuNoMapa(a, b) {
    let bateu=false; 
    for (var i = 0; i < map.length; i++) {
      for (var j = 0; j < map[i].length; j++) {
        if(map[i][j]==1 && colisao(a,b,j * tileSize,i * tileSize)){
          bateu=true;
          return bateu;
        }
      }
    }
    return bateu;
  }
  
  function dano(a, b) {
    let damage=false; 
    for (var i = 0; i < map.length; i++) {
      for (var j = 0; j < map[i].length; j++) {
        if(map[i][j]==2 && colisao(a,b,j * tileSize,i * tileSize)){
          damage=true;
          return damage;
        }
      }
    }
    return damage;
  }
  
  function colisao(x1,y1,x2,y2) {
    if(x1 > x2 + 45)
      return false;
    if(y1 > y2 + 45)
      return false;
    if(x1 + 45 < x2)
      return false;
    if(y1 + 45 < y2)
      return false;
    return true;
  }
}
</script>
</html>

